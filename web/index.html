<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Pinot - Ingresar con PIN</title>
  <meta name="theme-color" content="#6b21a8" />
  <meta name="description" content="Aplicaci√≥n PWA para participar en catas a ciegas" />
  <base href="/">
  
  <!-- Redirecci√≥n autom√°tica de pinot-tintum.web.app a pinot.tintum.app -->
  <script>
    // Redirigir inmediatamente si est√° en el dominio por defecto
    if (window.location.hostname === 'pinot-tintum.web.app') {
      const newUrl = 'https://pinot.tintum.app' + window.location.pathname + window.location.search + window.location.hash;
      window.location.replace(newUrl);
    }
  </script>
  
  <script>
    // Suprimir warning de producci√≥n de Tailwind CDN antes de cargar
    const originalWarn = console.warn;
    console.warn = function(...args) {
      if (args[0] && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com should not be used in production')) {
        return; // Suprimir este warning espec√≠fico
      }
      originalWarn.apply(console, args);
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Restaurar console.warn despu√©s de cargar Tailwind
    setTimeout(() => {
      console.warn = console.warn || (() => {});
    }, 1000);
  </script>
  
  <!-- Fuentes personalizadas -->
  <link rel="stylesheet" href="/css/fonts.css">
  
  <style>
    body { font-family: system-ui, -apple-system, Inter, Segoe UI, Roboto, sans-serif; }
    
    .draggable {
      user-select: none;
      -webkit-user-select: none;
    }
    
    .draggable:active {
      cursor: grabbing;
    }
    
    .droppable.drag-over {
      border-color: #8b5cf6;
      background-color: #f3e8ff;
    }
    
    .conexion-line {
      pointer-events: none;
    }
    
    /* Estilo minimalista para splash screen */
    .splash-screen {
      background: #000000;
    }
    
    .pin-input {
      font-size: 2rem;
      letter-spacing: 0.5rem;
      text-align: center;
    }
    
    /* Estilos para animaci√≥n del PIN */
    .pin-animated:not(:focus):placeholder-shown {
      color: transparent;
    }
    
    .pin-animation-text {
      font-family: inherit;
      user-select: none;
    }
    
    .pin-digit-underline {
      position: relative;
      text-decoration: underline;
      text-decoration-color: rgba(255, 255, 255, 0.6);
      text-decoration-thickness: 2px;
      text-underline-offset: 8px;
    }
    
    .pin-animation-overlay-hidden {
      display: none;
    }
    
    /* Video de fondo optimizado */
    #backgroundVideo {
      min-width: 100%;
      min-height: 100%;
      width: auto;
      height: auto;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    /* Asegurar que el video cubra toda la pantalla en m√≥viles */
    @media (max-width: 768px) {
      #backgroundVideo {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }
    
    /* Animaciones suaves */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    /* Estilos para la puerta animada */
    .door-container {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 30;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .door-container:hover {
      transform: scale(1.1);
    }
    
    .door-icon {
      width: 80px;
      height: 100px;
      position: relative;
      transition: transform 0.5s ease;
    }
    
    .door-frame {
      fill: rgba(255, 255, 255, 0.2);
      stroke: rgba(255, 255, 255, 0.5);
      stroke-width: 2;
      backdrop-filter: blur(10px);
    }
    
    .door-panel {
      fill: rgba(139, 92, 246, 0.8);
      stroke: rgba(255, 255, 255, 0.6);
      stroke-width: 2;
      transform-origin: left center;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .door-handle {
      fill: rgba(255, 255, 255, 0.9);
      transition: transform 0.3s ease;
    }
    
    .door-container:hover .door-panel {
      transform: perspective(500px) rotateY(-45deg) translateX(-5px);
    }
    
    .door-container:hover .door-handle {
      transform: translateX(2px);
    }
    
    .door-tooltip {
      position: absolute;
      bottom: 110px;
      right: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      pointer-events: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .door-tooltip::after {
      content: '';
      position: absolute;
      bottom: -6px;
      right: 20px;
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 6px solid rgba(0, 0, 0, 0.85);
    }
    
    .door-container:hover .door-tooltip {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Responsive: ocultar en m√≥viles muy peque√±os */
    @media (max-width: 640px) {
      .door-container {
        bottom: 1rem;
        right: 1rem;
      }
      
      .door-icon {
        width: 60px;
        height: 75px;
      }
      
      .door-tooltip {
        font-size: 12px;
        padding: 10px 12px;
        bottom: 85px;
      }
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- PANTALLA DE BIENVENIDA (HOME) -->
  <div id="splashScreen" class="min-h-screen splash-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
    <!-- Video de fondo en loop -->
    <video 
      id="backgroundVideo"
      class="absolute inset-0 w-full h-full object-cover z-0"
      autoplay
      muted
      loop
      playsinline
      preload="auto"
    >
      <source src="/images/intro-splash.mp4" type="video/mp4">
      <!-- Fallback si el video no carga -->
      <div class="absolute inset-0 bg-black"></div>
    </video>
    
    <!-- Overlay oscuro para mejorar legibilidad -->
    <div class="absolute inset-0 bg-black/40 z-10"></div>
    
    <!-- √çcono de Puerta Animado (Anfitri√≥n) -->
    <a href="/auth/signup-host-e.html" class="door-container" title="¬øQuieres ser anfitri√≥n?">
      <div class="door-icon">
        <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
          <!-- Marco de la puerta -->
          <rect x="10" y="10" width="80" height="100" rx="4" class="door-frame"/>
          <!-- Panel de la puerta -->
          <rect x="15" y="15" width="70" height="90" rx="2" class="door-panel"/>
          <!-- Manija -->
          <circle cx="75" cy="60" r="4" class="door-handle"/>
          <!-- L√≠nea decorativa vertical -->
          <line x1="50" y1="20" x2="50" y2="100" stroke="rgba(255, 255, 255, 0.3)" stroke-width="1"/>
        </svg>
      </div>
      <div class="door-tooltip">
        üé≠ ¬øQuieres ser anfitri√≥n?
      </div>
    </a>
    
    <!-- Contenido Principal (sobre el video) -->
    <div class="max-w-sm w-full space-y-6 flex-1 flex flex-col justify-center relative z-20">
      <!-- Frase sobre el PIN -->
      <p class="text-white text-center text-lg font-light italic mb-2 drop-shadow-lg">
        El vino como juego. El disfrute como premio.
      </p>
      
      <!-- Campo PIN -->
      <div class="relative w-full">
        <input 
          type="text" 
          id="pinInput" 
          inputmode="numeric"
          pattern="[0-9]*"
          maxlength="5"
          placeholder="00000"
          class="w-full px-6 py-4 bg-gray-900 border-2 border-gray-700 rounded-lg text-center text-4xl font-bold text-white focus:outline-none focus:border-white transition-all pin-input pin-animated"
          autocomplete="off"
          style="letter-spacing: 0.5rem;"
        />
        <!-- Overlay para mostrar animaci√≥n con subrayado -->
        <div id="pinAnimationOverlay" class="absolute inset-0 pointer-events-none flex items-center justify-center">
          <div id="pinAnimationText" class="text-4xl font-bold text-white/40 pin-animation-text" style="letter-spacing: 0.5rem;">
            <span class="pin-digit-underline">0</span><span>0</span><span>0</span><span>0</span><span>0</span>
          </div>
        </div>
      </div>
      <p id="pinError" class="text-white text-sm text-center hidden drop-shadow-lg"></p>
      
      <!-- Bot√≥n Ingresar -->
      <button 
        id="btnIngresar"
        class="w-full py-4 bg-white hover:bg-gray-100 text-black font-bold text-xl rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Ingresar
      </button>
    </div>
  </div>

  <!-- CONTENIDO PRINCIPAL (oculto inicialmente) -->
  <main id="mainContent" class="min-h-screen bg-gray-50 hidden">
    <div class="max-w-2xl mx-auto p-6 space-y-6">
    
    <!-- HEADER -->
    <header class="flex items-center justify-between mb-4">
      <button 
        id="btnCerrarSesion"
        class="px-3 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-xl shadow transition-colors flex items-center gap-2"
        title="Cerrar sesi√≥n y cambiar de evento"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
        <span class="hidden sm:inline">Cerrar sesi√≥n</span>
      </button>
      <div class="text-center flex-1">
        <h1 class="text-2xl font-bold text-purple-700">Cata a Ciegas</h1>
      </div>
      <div class="w-24"></div> <!-- Espaciador para centrar el t√≠tulo -->
    </header>

    <!-- INFORMACI√ìN DEL EVENTO Y USUARIO -->
    <section id="infoEvento" class="bg-white rounded-xl shadow p-4 mb-4">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
        <div class="flex-1 text-center sm:text-left">
          <h2 id="tituloEvento" class="text-lg font-semibold text-gray-900">Cargando evento...</h2>
          <p id="fechaEvento" class="text-sm text-gray-600 mt-1"></p>
        </div>
        <div id="nombreUsuarioHeader" class="hidden px-4 py-2 bg-purple-50 border border-purple-200 rounded-lg">
          <p class="text-sm font-semibold text-purple-700">
            üë§ <span id="nombreUsuarioTexto"></span>
          </p>
        </div>
      </div>
    </section>

    <!-- TIMER DE VOTACI√ìN -->
    <section id="timerVotacion" class="bg-blue-50 border-2 border-blue-300 rounded-xl shadow p-4 hidden">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="text-3xl">‚è±Ô∏è</span>
          <div>
            <p class="text-sm font-semibold text-blue-800">Tiempo restante para votar</p>
            <p id="timerVotacionDisplay" class="text-3xl font-bold text-blue-900">--:--</p>
          </div>
        </div>
      </div>
    </section>

    <!-- PASO 1: SELECCIONAR NOMBRE -->
    <section id="pasoNombre" class="bg-white rounded-xl shadow p-6 space-y-4">
      <h2 class="text-xl font-semibold">Paso 1: Seleccionar tu nombre</h2>
      <p class="text-sm text-gray-600">Eleg√≠ tu nombre de la lista habilitada por el anfitri√≥n</p>
      
      <div id="contenedorNombres" class="space-y-2 max-h-96 overflow-y-auto">
        <!-- Los nombres se cargar√°n aqu√≠ din√°micamente -->
        <p class="text-gray-600 text-sm">Cargando nombres disponibles...</p>
      </div>
      
      <div class="flex justify-end pt-2">
        <button id="btnContinuarNombre" 
                class="px-4 py-2 bg-purple-600 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed"
                disabled>
          Continuar
        </button>
      </div>
      <p id="msgNombre" class="text-sm text-gray-600"></p>
    </section>

    <!-- PASO 2: CONECTAR ETIQUETAS Y NAIPES -->
    <section id="pasoEtiquetas" class="bg-white rounded-xl shadow p-6 space-y-4 hidden">
      <h2 class="text-xl font-semibold">Paso 2: Conectar Etiquetas con Naipes</h2>
      <p class="text-sm text-gray-600">Arrastr√° cada naipe hacia su etiqueta correspondiente</p>
      
      <div class="relative">
        <!-- √Årea de conexiones visuales (SVG) -->
        <svg id="svgConexiones" class="absolute inset-0 w-full h-full pointer-events-none z-0" style="height: 500px;">
          <!-- Las l√≠neas de conexi√≥n se dibujar√°n aqu√≠ -->
        </svg>
        
        <!-- Contenido principal -->
        <div class="grid md:grid-cols-2 gap-6 min-h-[500px] relative z-10">
          <!-- Columna izquierda: Etiquetas -->
          <div class="space-y-3">
            <h3 class="text-lg font-semibold text-purple-700 mb-3">Etiquetas</h3>
            <div id="contenedorEtiquetas" class="space-y-3 min-h-[400px]">
              <!-- Las etiquetas se cargar√°n aqu√≠ din√°micamente -->
            </div>
          </div>
          
          <!-- Columna derecha: Naipes -->
          <div class="space-y-3">
            <h3 class="text-lg font-semibold text-blue-700 mb-3">Naipes</h3>
            <div id="contenedorNaipes" class="space-y-2 min-h-[400px]">
              <!-- Los naipes se cargar√°n aqu√≠ din√°micamente -->
            </div>
          </div>
        </div>
      </div>
      
      <div class="pt-4 border-t">
        <div class="flex gap-3">
          <button id="btnLimpiarTodo" 
                  class="flex-1 px-4 py-2 bg-red-600 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:bg-red-700"
                  disabled>
            Limpiar todo
          </button>
          <button id="btnFinalizar" 
                  class="flex-1 px-4 py-2 bg-green-600 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:bg-green-700"
                  disabled>
            Finalizar
          </button>
        </div>
        <p id="msgEtiquetas" class="text-sm text-gray-600 mt-2"></p>
      </div>
    </section>

    <!-- PASO 4: SELECCIONES FINALIZADAS / RANKING -->
    <section id="pasoRanking" class="bg-white rounded-xl shadow p-6 space-y-4 hidden">
      <h2 class="text-xl font-semibold" id="tituloRanking">Resultados</h2>
      <p class="text-sm text-gray-600" id="mensajeRanking">Esperando a que el anfitri√≥n revele los resultados...</p>
      
      <!-- MI VOTACI√ìN: ACIERTOS VS FALLOS -->
      <div id="contenedorRanking" class="space-y-3">
        <!-- El resumen de aciertos/fallos se mostrar√° aqu√≠ -->
      </div>
      
      <!-- SOLUCI√ìN DEL EVENTO (solo cuando el evento est√© finalizado) -->
      <section id="respuestasCorrectasParticipante" class="bg-green-50 border-2 border-green-300 rounded-xl shadow p-6 space-y-4 hidden">
        <h2 class="text-xl font-semibold text-green-800">‚úÖ Soluci√≥n del evento</h2>
        <div id="contenedorRespuestasCorrectasParticipante" class="space-y-2">
          <!-- Las respuestas correctas se cargar√°n aqu√≠ -->
        </div>
      </section>
      
      <!-- OTROS RESULTADOS (solo cuando el evento est√© finalizado) -->
      <section id="resultadosTodosParticipantes" class="bg-white rounded-xl shadow p-6 space-y-4 hidden">
        <h2 class="text-xl font-semibold text-gray-900">Otros resultados</h2>
        <div id="contenedorResultadosTodos" class="space-y-4">
          <!-- Los resultados se cargar√°n aqu√≠ -->
        </div>
      </section>
      
      <div class="pt-4 border-t">
        <p class="text-sm text-gray-600 text-center" id="mensajeFinal">
          Gracias por participar. Los resultados se mostrar√°n cuando el anfitri√≥n los revele.
        </p>
      </div>
    </section>

  </main>

  <!-- Script para manejar el video de fondo y animaci√≥n del PIN -->
  <script>
    // Inicializar video de fondo
    document.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('backgroundVideo');
      
      if (video) {
        // Asegurar que el video se reproduzca en loop
        video.loop = true;
        video.muted = true;
        video.playsInline = true;
        
        // Intentar reproducir (algunos navegadores requieren interacci√≥n del usuario)
        video.play().catch(error => {
          console.log('Autoplay bloqueado, el video se reproducir√° cuando el usuario interact√∫e:', error);
          // Si el autoplay falla, intentar reproducir cuando el usuario interact√∫e
          const playVideo = () => {
            video.play().catch(() => {});
            document.removeEventListener('click', playVideo);
            document.removeEventListener('touchstart', playVideo);
          };
          document.addEventListener('click', playVideo, { once: true });
          document.addEventListener('touchstart', playVideo, { once: true });
        });
        
        // Manejar errores de carga del video
        video.addEventListener('error', (e) => {
          console.error('Error al cargar el video:', e);
          // Si el video falla, mostrar fondo negro s√≥lido
          const overlay = document.querySelector('.splash-screen .bg-black\\/40');
          if (overlay) {
            overlay.classList.remove('bg-black/40');
            overlay.classList.add('bg-black');
          }
        });
        
        // Asegurar que el video est√© en loop
        video.addEventListener('ended', () => {
          video.currentTime = 0;
          video.play();
        });
      }
      
      // Animaci√≥n de n√∫meros aleatorios en el campo PIN
      const pinInput = document.getElementById('pinInput');
      const pinAnimationOverlay = document.getElementById('pinAnimationOverlay');
      const pinAnimationText = document.getElementById('pinAnimationText');
      let animationInterval = null;
      let isUserTyping = false;
      let currentDigitIndex = 0;
      
      if (pinInput && pinAnimationOverlay && pinAnimationText) {
        // Funci√≥n para generar un PIN aleatorio de 5 d√≠gitos
        function generateRandomPIN() {
          return Math.floor(10000 + Math.random() * 90000).toString();
        }
        
        // Funci√≥n para actualizar la animaci√≥n con subrayado rotativo
        function updatePINAnimation() {
          const pin = generateRandomPIN();
          const digits = pin.split('');
          
          // Crear HTML con subrayado en el d√≠gito actual
          const html = digits.map((digit, index) => {
            if (index === currentDigitIndex) {
              return `<span class="pin-digit-underline">${digit}</span>`;
            }
            return `<span>${digit}</span>`;
          }).join('');
          
          pinAnimationText.innerHTML = html;
          
          // Rotar el √≠ndice del d√≠gito subrayado
          currentDigitIndex = (currentDigitIndex + 1) % 5;
        }
        
        // Funci√≥n para iniciar la animaci√≥n
        function startPINAnimation() {
          if (animationInterval) return; // Ya est√° animando
          
          // Mostrar overlay
          pinAnimationOverlay.classList.remove('pin-animation-overlay-hidden');
          pinInput.placeholder = '';
          
          // Actualizar inmediatamente
          updatePINAnimation();
          
          // Cambiar cada 2 segundos
          animationInterval = setInterval(() => {
            if (!isUserTyping && pinInput.value === '') {
              updatePINAnimation();
            }
          }, 2000); // Cambia cada 2 segundos
        }
        
        // Funci√≥n para detener la animaci√≥n
        function stopPINAnimation() {
          if (animationInterval) {
            clearInterval(animationInterval);
            animationInterval = null;
          }
          // Ocultar overlay
          pinAnimationOverlay.classList.add('pin-animation-overlay-hidden');
          pinInput.placeholder = '00000';
        }
        
        // Detectar cuando el usuario empieza a escribir
        pinInput.addEventListener('focus', () => {
          isUserTyping = true;
          stopPINAnimation();
          if (pinInput.value === '') {
            pinInput.value = '';
          }
        });
        
        pinInput.addEventListener('input', () => {
          isUserTyping = true;
          stopPINAnimation();
        });
        
        // Detectar cuando el usuario sale del campo sin escribir
        pinInput.addEventListener('blur', () => {
          if (pinInput.value === '') {
            isUserTyping = false;
            currentDigitIndex = 0; // Resetear √≠ndice
            startPINAnimation();
          }
        });
        
        // Iniciar animaci√≥n cuando la p√°gina carga
        setTimeout(() => {
          if (pinInput.value === '') {
            startPINAnimation();
          }
        }, 500); // Esperar medio segundo antes de iniciar
        
        // Validaci√≥n: solo aceptar n√∫meros
        pinInput.addEventListener('keydown', (e) => {
          // Permitir teclas de control (backspace, delete, tab, escape, enter, etc.)
          if (e.key === 'Backspace' || e.key === 'Delete' || e.key === 'Tab' || 
              e.key === 'Escape' || e.key === 'Enter' || e.key === 'ArrowLeft' || 
              e.key === 'ArrowRight' || e.key === 'ArrowUp' || e.key === 'ArrowDown' ||
              (e.ctrlKey && (e.key === 'a' || e.key === 'c' || e.key === 'v' || e.key === 'x'))) {
            return; // Permitir estas teclas
          }
          
          // Solo permitir n√∫meros (0-9)
          if (!/^[0-9]$/.test(e.key)) {
            e.preventDefault(); // Bloquear cualquier otro car√°cter
            return false;
          }
        });
        
        // Validaci√≥n adicional en input (por si se pega texto)
        pinInput.addEventListener('input', (e) => {
          // Remover cualquier car√°cter que no sea n√∫mero
          const value = e.target.value.replace(/[^0-9]/g, '');
          
          // Limitar a 5 d√≠gitos
          if (value.length > 5) {
            e.target.value = value.substring(0, 5);
          } else {
            e.target.value = value;
          }
        });
        
        // Validaci√≥n en paste (pegar)
        pinInput.addEventListener('paste', (e) => {
          e.preventDefault();
          const pastedText = (e.clipboardData || window.clipboardData).getData('text');
          // Solo extraer n√∫meros y limitar a 5
          const numbersOnly = pastedText.replace(/[^0-9]/g, '').substring(0, 5);
          pinInput.value = numbersOnly;
        });
      }
    });
  </script>
  
  <!-- Firebase SDK -->
  <script type="module" src="/js/core/firebase-config.js"></script>
  <script type="module" src="/js/constantes.js"></script>
  <script type="module" src="/js/participar.js"></script>
</body>
</html>



